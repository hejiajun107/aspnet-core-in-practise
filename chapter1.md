# OIDC在 ASP.NET Core中的应用

我们在《ASP.NET Core项目实战的课程》第一章里面给identity server4做了一个全面的介绍和示例的练习 。

如果想完全理解本文所涉及到的话题，你需要了解的背景知识有：

* 什么是OpenId Connect \(OIDC\)

* Identity Server4又是什么

* ASP.NET Core的权限体系中的OIDC认证框架（客户端）

* Identity Server4提供的OIDC认证服务（服务端）

* 客户端与服务端的集成

### 什么是 OIDC

在了解OIDC之前，我们先看一个很常见的场景。假使我们现在有一个网站要集成微信或者新浪微博的登录，两者现在依然采用的是oAuth 2.0的协议来实现 。如果不熟悉oAauth2.0的同学建议去复习一下（OIDC也是建议在oAauth2.0协议之上） 同时关于微信和新浪微博的登录大家可以去看看它们的开发文档。

在我们的网站集成微博或者新浪微博的过程大致是分为五步：

1. 准备工作：在微信/新浪微博开发平台注册一个应用，得到AppId和AppSecret

2. 发起 oAauth2.0 中的 Authorization Code流程请求Code

3. 根据Code再请求AccessToken（通常在我们应用的后端完成，用户不可见）

4. 根据 AccessToken 访问微信/新浪微博的某一个API，来获取用户的信息

5. 后置工作：根据用户信息来判断是否之前登录过？如果没有则创建一个用户并将这个用户作为当前用户登录（我们自己应用的登录逻辑，比如生成jwt），如果有了则用之前的用户登录。

中间第2到3的步骤为标准的oAuth2 授权码模式的流程，如果不理解的可以参考阮一峰所写的《[理解oAuth2.0 ](http://www.ruanyifeng.com/blog/2014/05/oauth_2_0.html)》一文。我们主要来看第4和5步，对于第三方应用要集成微博登录这个场景来说最重要的是我希望能快速拿到用户的一些基本信息（免去用户再次输入的麻烦）然后根据这些信息来生成一个我自己的用户跟微博的用户Id绑定（为的是下次你使用微博登录的时候我还能把你再找出来）。 

oAuth在这里麻烦的地方是我还需要再请求一次API去获取用户数据，并且几乎大家都在这么干，于是OIDC就干脆建立了一套标准协议，并给它起了个名字。

> OIDC 建立在oAuth2.0协议之上，允许客户端\(Clients\)通过一个授权服务\(Authorization Server\)来完成对用户认证的过程，并且可以得到用户的一些基本信息。

所以大家注意到，oAuth负责授权，OIDC建立在oAuth协议之上，它负责认证并且可以让你获取到认证用户的一些信息。























